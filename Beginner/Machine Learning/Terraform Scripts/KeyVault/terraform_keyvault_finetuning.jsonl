{"prompt": "Write a script for a Terraform main file to fetch various values from Azure Key Vault to create an image VM for AVD.", "completion": "variable \"key_vault_name\" {\n  description = \"The name of the existing Key Vault\"\n  type        = string\n}\n\nvariable \"resource_group_name\" {\n  description = \"The name of the resource group containing the Key Vault\"\n  type        = string\n}\n\nvariable \"secret_names\" {\n  description = \"Map of secret names to be fetched from the Key Vault\"\n  type = map(string)\n  default = {\n    vmusername         = \"VmAdminUsername\"\n    vmadminpassword    = \"VmAdminPassword\"\n    domainadminusername = \"DomainAdminUserName\"\n    domainadminpassword = \"DomainAdminPassword\"\n    domainname         = \"DomainName\"\n  }\n}\n\ndata \"azurerm_key_vault\" \"existing\" {\n  provider            = azurerm.kv_provider\n  name                = var.key_vault_name\n  resource_group_name = var.resource_group_name\n}\n\ndata \"azurerm_key_vault_secret\" \"vmusername\" {\n  provider     = azurerm.kv_provider\n  name         = var.secret_names[\"vmusername\"]\n  key_vault_id = data.azurerm_key_vault.existing.id\n}\n\ndata \"azurerm_key_vault_secret\" \"vmadminpassword\" {\n  provider     = azurerm.kv_provider\n  name         = var.secret_names[\"vmadminpassword\"]\n  key_vault_id = data.azurerm_key_vault.existing.id\n}\n\ndata \"azurerm_key_vault_secret\" \"domainadminusername\" {\n  provider     = azurerm.kv_provider\n  name         = var.secret_names[\"domainadminusername\"]\n  key_vault_id = data.azurerm_key_vault.existing.id\n}\n\ndata \"azurerm_key_vault_secret\" \"domainadminpassword\" {\n  provider     = azurerm.kv_provider\n  name         = var.secret_names[\"domainadminpassword\"]\n  key_vault_id = data.azurerm_key_vault.existing.id\n}\n\ndata \"azurerm_key_vault_secret\" \"domainname\" {\n  provider     = azurerm.kv_provider\n  name         = var.secret_names[\"domainname\"]\n  key_vault_id = data.azurerm_key_vault.existing.id\n}"}
{"prompt": "Write an optimized Terraform script to dynamically fetch secrets from Azure Key Vault for an AVD VM deployment.", "completion": "variable \"key_vault_name\" {\n  description = \"The name of the existing Azure Key Vault\"\n  type        = string\n}\n\nvariable \"resource_group_name\" {\n  description = \"The name of the resource group containing the Key Vault\"\n  type        = string\n}\n\nvariable \"secret_names\" {\n  description = \"Map of secret names to be fetched from the Key Vault\"\n  type = map(string)\n  default = {\n    vmusername         = \"VmAdminUsername\"\n    vmadminpassword    = \"VmAdminPassword\"\n    domainadminusername = \"DomainAdminUserName\"\n    domainadminpassword = \"DomainAdminPassword\"\n    domainname         = \"DomainName\"\n  }\n}\n\nlocals {\n  secrets_to_fetch = {\n    for key, secret_name in var.secret_names :\n    key => secret_name\n  }\n}\n\ndata \"azurerm_key_vault_secret\" \"secrets\" {\n  for_each = local.secrets_to_fetch\n  provider     = azurerm.kv_provider\n  name         = each.value\n  key_vault_id = data.azurerm_key_vault.existing.id\n}\n\noutput \"fetched_secrets\" {\n  value       = { for k, v in data.azurerm_key_vault_secret.secrets : k => v.value }\n  sensitive   = true\n}"}